<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Workshop Game</title>
    <link href="style.css" rel="stylesheet" media="screen" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="meta/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="meta/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="meta/favicon-16x16.png"
    />
    <link rel="manifest" href="meta/site.webmanifest" />
    <link rel="mask-icon" href="meta/safari-pinned-tab.svg" color="#5bbad5" />
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="theme-color" content="#ffffff" />
  </head>
  <body>
    <header>
      <section id="player">
        <ul>
          <li>
            <img src="icons/shield.svg" /> <span id="playerName">Marius</span>
          </li>
          <li>
            <img src="icons/energydrink.svg" title="energy" />
            <span id="energy">3</span>
          </li>
          <li>
            <img src="icons/notebook.svg" /> <span id="notebookItems">0</span>
          </li>
          <li>
            <img src="icons/solution.svg" /> <span id="points">0</span> poeng
          </li>
          <li><img src="icons/clock.svg" /> <span id="duration">0</span></li>
        </ul>
      </section>
      <img src="icons/c3_logo.svg" alt="Code Concept Collector" />
      <nav>
        <button id="notebookToggler">
          <img src="icons/notebook.svg" />Åpne kladdeboka
          <span class="shortcut">n</span>
        </button>
        <button id="infoToggler">
          Info / Hvordan spille <span class="shortcut">i</span>
        </button>
      </nav>
    </header>
    <main>
      <canvas id="anim-area"></canvas>
      <section id="notebook">
        <div id="notebook-page">
          <h2>Notater</h2>
          <table>
            <tr>
              <td><img src="icons/variable.svg" alt="" /></td>
              <td>Variabler</td>
              <td><span id="variables">0</span></td>
            </tr>
            <tr>
              <td><img src="icons/array.svg" alt="" /></td>
              <td>Arrayer</td>
              <td><span id="arrays">1</span></td>
            </tr>
            <tr>
              <td><img src="icons/loop.svg" alt="" /></td>
              <td>Løkker</td>
              <td><span id="loops">2</span></td>
            </tr>
            <tr>
              <td><img src="icons/function.svg" alt="" /></td>
              <td>Funksjoner</td>
              <td><span id="functions">1</span></td>
            </tr>
          </table>
        </div>
      </section>
      <section id="info" class="hidden">
        <div id="info-page">
          <h2>Info / Hvordan spille C<sup>3</sup></h2>
          <p>
            Målet med spiller er at programmeringsstudenten Fortran
            <span class="illustration">(<img src="icons/fortran.svg" />)</span>
            skal samle programmeringskonseptene variabler
            <span class="illustration">(<img src="icons/variable.svg" />)</span
            >, arrayer
            <span class="illustration">(<img src="icons/array.svg" />)</span>,
            løkker
            <span class="illustration">(<img src="icons/loop.svg" />)</span> og
            funksjoner
            <span class="illustration">(<img src="icons/function.svg" />)</span>
            i kladdeboka
            <span class="illustration">(<img src="icons/notebook.svg" />)</span>
            si.
          </p>
          <p>
            Etterhvert kan Fortran bruke de oppsamlede konseptene for å løse
            oppgaver
            <span class="illustration">(<img src="icons/puzzle.svg" />)</span>.
            Det koster en energi
            <span class="illustration"
              >(<img src="icons/energydrink.svg" />)</span
            >. Dersom Fortran ikke løser oppgaven korrekt, mister han enda en
            energi, i tillegg til å ha brukt opp programmeringskonseptene han
            har brukt i oppgaven.
          </p>
          <p>
            Gjennom spillet samler Fortran de nevnte konseptene og
            energidrikker. Men, det vil også komme bugs
            <span class="illustration">(<img src="icons/bug.svg" />)</span>!
            Pass på så Fortran ikke samler bugs, de koster det en energidrikke
            og løse opp!
          </p>
          <h2>Hvordan spille</h2>
          <p>
            Bruk piltastene for å flytte Fortran rundt og samle konsepter og
            energidrikker, og unngå bugs.
          </p>
          <p>
            Klikk knappen "Åpne kladdeboka", eller snarveien N for å åpne
            kladdeboka og se hvor mange konsepter Fortran har samlet.
          </p>
          <p>
            Gå på en oppgave når denne dukker opp for å løse en oppgave for å
            score poeng. Du får 10 poeng for å løse en oppgave, 1 poeng for
            hvert konsept du samler.
          </p>
        </div>
      </section>
    </main>
    <script>
const canvas = document.getElementById("anim-area");
canvas.width = 800;
canvas.height = 600;
const ctx = canvas.getContext("2d");

// --- GAME CONFIG ---
const gameConfig = {
    playerName: "Adrian",
    energy: 10,
    points: 0,
    duration: 0,
    gamePaused: false,
    pauseText: "Press P to pause"
};

console.log(gameConfig);

// --- NOTEBOOK ---
const notebook = {
    variables: 2,
    loops: 4,
    functions: 3,
    arrays: 7
};

// --- PLAYER ---
const fortran = {
    x: canvas.width / 2,
    y: canvas.height / 2,
    width: 64,
    height: 64,
    speed: 3
};

// --- ITEMS ---
const itemTypes = ["variable", "function", "loop", "array", "bug", "energydrink"];
let items = [
    {type: "variable", x: 100, y: 50, lifetime: 8, caught: false},
    {type: "loop", x: 430, y: 290, lifetime: 3, caught: false},
    {type: "bug", x: 500, y: 400, lifetime: 0, caught: false, dx: (Math.random()-0.5)*2, dy: (Math.random()-0.5)*2},
    {type: "function", x: 300, y: 400, lifetime: 3, caught: false}
];

// --- PLAYER IMAGE ---
let fortranLoaded = false;
const fortranImage = new Image();
fortranImage.src = "icons/fortran.png";
fortranImage.onload = () => { fortranLoaded = true; };

// --- KEYBOARD CONTROL ---
let moving = { up: false, down: false, left: false, right: false };
document.addEventListener("keydown", (e) => {
    if(e.code === "ArrowUp" || e.code === "KeyW") moving.up = true;
    if(e.code === "ArrowDown" || e.code === "KeyS") moving.down = true;
    if(e.code === "ArrowLeft" || e.code === "KeyA") moving.left = true;
    if(e.code === "ArrowRight" || e.code === "KeyD") moving.right = true;
    if(e.code === "KeyN") toggleVisibility("notebook");
    if(e.code === "KeyI") toggleVisibility("info");
    if(e.code === "KeyP") gameConfig.gamePaused = !gameConfig.gamePaused;
});
document.addEventListener("keyup", (e) => {
    if(e.code === "ArrowUp" || e.code === "KeyW") moving.up = false;
    if(e.code === "ArrowDown" || e.code === "KeyS") moving.down = false;
    if(e.code === "ArrowLeft" || e.code === "KeyA") moving.left = false;
    if(e.code === "ArrowRight" || e.code === "KeyD") moving.right = false;
});

// --- TOGGLE UI ---
function toggleVisibility(id) {
    const elem = document.getElementById(id);
    if(elem.classList.contains("hidden")) {
        elem.style.display = "block";
        elem.classList.remove("hidden");
    } else {
        elem.style.display = "none";
        elem.classList.add("hidden");
    }
}
document.getElementById("infoToggler").addEventListener("click", () => toggleVisibility("info"));
document.getElementById("notebookToggler").addEventListener("click", () => toggleVisibility("notebook"));

// --- DRAW ITEM ---
function drawItem(item) {
    const img = new Image();
    img.src = `icons/${item.type}.svg`;
    ctx.drawImage(img, item.x, item.y);

    if(item.type !== "bug") {
        ctx.beginPath();
        ctx.arc(item.x, item.y, 10, 0, 2*Math.PI);
        ctx.fillStyle = "red";
        ctx.fill();
        ctx.fillStyle = "white";
        ctx.font = "11px Verdana";
        ctx.fillText(Math.ceil(item.lifetime), item.x-4, item.y+4);
        ctx.closePath();
    }
}

// --- UPDATE ITEMS ---
function updateItems() {
    items.forEach(item => {
        if(item.type === "bug") {
            item.x += item.dx;
            item.y += item.dy;
            // bounce off edges
            if(item.x < 0 || item.x > canvas.width - 32) item.dx *= -1;
            if(item.y < 0 || item.y > canvas.height - 32) item.dy *= -1;
        } else if(item.lifetime > 0) {
            item.lifetime -= 1/60;
        }
    });
    // remove caught or expired
    items = items.filter(i => !i.caught && (i.type === "bug" || i.lifetime > 0));
}

// --- SPAWN ITEMS ---
function randomMinMax(min,max) { return Math.floor(Math.random()*(max-min+1))+min; }
function spawnItem() {
    const type = itemTypes[randomMinMax(0,itemTypes.length-1)];
    const x = randomMinMax(50, canvas.width-50);
    const y = randomMinMax(50, canvas.height-50);
    const lifetime = type === "bug" ? 0 : randomMinMax(3,10);
    let newItem = { type, x, y, lifetime, caught: false };
    if(type === "bug") {
        newItem.dx = (Math.random()-0.5)*2;
        newItem.dy = (Math.random()-0.5)*2;
    }
    items.push(newItem);
    setTimeout(spawnItem, randomMinMax(1000, 3000));
}
spawnItem();



// --- UPDATE STATIC UI ---
function updateStaticUI() {
    document.getElementById("playerName").textContent = gameConfig.playerName;
    document.getElementById("energy").textContent = gameConfig.energy;
    document.getElementById("points").textContent = gameConfig.points;
    document.getElementById("duration").textContent = gameConfig.duration;
    document.getElementById("variables").textContent = notebook.variables;
    document.getElementById("arrays").textContent = notebook.arrays;
    document.getElementById("loops").textContent = notebook.loops;
    document.getElementById("functions").textContent = notebook.functions;
}
updateStaticUI();

// --- DURATION TIMER ---
setInterval(() => {
    if(!gameConfig.gamePaused){
        gameConfig.duration++;
        updateStaticUI();
    }
    updateStaticUI("duration", gameConfig.duration);

    items.forEach((item) => {
      item.liftime--
    })
}, 1000);

// --- DRAW LOOP ---
function drawElements() {
    if(!gameConfig.gamePaused) updateItems();

    ctx.clearRect(0,0,canvas.width,canvas.height);

    // move player
    if(moving.up && fortran.y>0) fortran.y-=fortran.speed;
    if(moving.down && fortran.y<canvas.height-fortran.height) fortran.y+=fortran.speed;
    if(moving.left && fortran.x>0) fortran.x-=fortran.speed;
    if(moving.right && fortran.x<canvas.width-fortran.width) fortran.x+=fortran.speed;

    checkCollisions();

    // draw Fortran
    if(fortranLoaded) ctx.drawImage(fortranImage, fortran.x, fortran.y);

    if(gameConfig.gamePaused === true){
      ctx.beginPath();
      ctx.fillStyle = "red";
      ctx.font = "3rem Arial";
      ctx.fillText("PAUSED", canvas.width / 2 - 100, canvas.height / 2);
      ctx.closePath();
      gameConfig.pauseText = "Press P to upause";
      requestAnimationFrame(drawElements);
      return;
    } else {
      gameConfig.pauseText = "Press P to pause";
    }

    if(checkGameOver()) return;
    // draw items
    items.forEach(drawItem);

    // draw pause text
    ctx.fillStyle = "#fff";
    ctx.fillRect(canvas.width-150, canvas.height-25, 150, 25);
    ctx.fillStyle = "#3c429b";
    ctx.font = "1rem Arial";
    ctx.fillText(gameConfig.gamePaused ? "Press P to unpause" : "Press P to pause", canvas.width-143, canvas.height-7);

    requestAnimationFrame(drawElements);
}
drawElements();

function checkCollisions() {
  items.forEach(item => {
    if(item.caught) return;

    const collided = fortran.x < item.x + 32 &&
                     fortran.x + fortran.width > item.x &&
                     fortran.y < item.y + 32 &&
                     fortran.y + fortran.height > item.y;
    if(collided){
      if(item.type === "bug"){
        gameConfig.energy = Math.max(0, gameConfig.energy - 2);
      }
      else if(item.type === "energydrink") {
        gameConfig.energy += 1;
      }
      else {
        notebook[item.type + "s"] += 1;
        gameConfig.points += 1;
      }
      item.caught = true;

      updateStaticUI();
    }
});
}

  function checkGameOver() {
    if(gameConfig.energy <= 0){
      ctx.fillStyle = "red";
      ctx.font = "4rem Arial";
      ctx.fillText("GAME OVER", canvas.width / 2 - 150, canvas.height / 2);
      return true;
    }
    return false;
  }
</script>

  </body>
</html>